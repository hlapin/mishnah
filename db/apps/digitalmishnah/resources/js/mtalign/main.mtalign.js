(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{39:function(e,t,a){e.exports=a(61)},48:function(e,t,a){},54:function(e,t,a){},55:function(e,t,a){},56:function(e,t,a){},57:function(e,t,a){},61:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(33),o=a.n(i),s=a(12),c=a(29),p=(a(48),a(15)),h=a(19),l=a(32),u=a(21),d=a(37),m=a.n(d),f="/exist/apps/digitalmishnah/modules",C="".concat(f,"/getMishnah.xql?ch="),g="".concat(f,"/getTosefta.xql?ch="),y="".concat(f,"/getAlignedTosefta.xql?alignment="),v="".concat(f,"/getAlignedMishnah.xql?alignment="),b="".concat(f,"/getMTalign.xql?chapter="),T="".concat(f,"/getTMalign.xql?chapter="),E="REQUEST_RESOURCE",O="RECEIVE_RESOURCE",x="SELECT_LINK",k="CLEAR_TOSEFTA_CHAPTER",j="CLEAR_MISHNAH_CHAPTER";function A(e,t,a){return{type:E,url:e,docType:t,chapter:a}}function D(e,t,a){return{type:O,data:e,receivedAt:Date.now(),docType:t,chapter:a}}function w(e){return function(t){var a="".concat(C).concat(e);return t(A(a,"mishnahChapter",e)),fetch(a).then(function(e){return e.text()}).then(function(a){t(D(a,"mishnahChapter",e))})}}function M(e){return function(t){var a="".concat(g).concat(e);return t(A(a,"toseftaChapter",e)),fetch(a).then(function(e){return e.text()}).then(function(a){t(D(a,"toseftaChapter",e))})}}function S(e){return function(t){var a="".concat(b).concat(e);return t(A(a,"alignment")),fetch(a).then(function(e){return e.json()}).then(function(a){var n;t(D(a,"alignment")),t((n=a,function(e){var t="".concat(y).concat(n);return e(A(t,"alignedTosefta")),fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.text()}).then(function(t){e(D(t,"alignedTosefta"))})})),t(w(e))})}}function L(e){return function(t){var a="".concat(T).concat(e);return t(A(a,"alignment")),fetch(a).then(function(e){return e.json()}).then(function(a){var n;t(D(a,"alignment")),t((n=a,function(e){var t="".concat(v).concat(n);return e(A(t,"alignedMishnah")),fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){return e.text()}).then(function(t){e(D(t,"alignedMishnah"))})})),t(M(e))})}}function _(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case O:case E:case x:case k:case j:return Object.assign({},function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a={};switch(t.type){case E:return(a={})[t.docType]={isFetching:!0},Object.assign({},e,a);case O:a={};var n={isFetching:!1,data:t.data,lastUpdated:t.receivedAt};return t.chapter&&(n.chapter=t.chapter),a[t.docType]=n,Object.assign({},e,a);case x:return(a=Object.assign({},e)).alignment.data=a.alignment.data.map(function(e,a){return a===t.idx?e.selected=!0:e.selected=!1,e}),a;case k:return e.toseftaChapter?(delete(a=Object.assign({},e)).toseftaChapter,a):e;case j:return e.mishnahChapter?(delete(a=Object.assign({},e)).mishnahChapter,a):e;default:return e}}(e,t));default:return e}}var N=function(e){return Object(p.c)({resources:_,router:Object(u.b)(e)})},R=a(4),I=a(10),V=a(11),H=a(14),U=a(7),q=a(13),W=(a(54),a(38)),P=(a(55),a(22)),F=(a(56),function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(H.a)(this,Object(U.a)(t).call(this,e))).teiRef=r.a.createRef(),a}return Object(q.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){this.scrollSelectionIntoView()}},{key:"componentDidUpdate",value:function(){this.scrollSelectionIntoView()}},{key:"scrollSelectionIntoView",value:function(){this.props.matches.filter(function(e){return e.selected}).length>0&&this.teiRef.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}},{key:"getRoleClass",value:function(){return this.props.dataType.match("Aligned")&&0===this.props.matches.length?"WHide":Array.from(this.props.matches.reduce(function(e,t){switch(t.role){case"linked":e.add("WLinked");break;case"firstLinked":e.add("WLinked"),e.add("WFirst");break;case"lastLinked":e.add("WLinked"),e.add("WLast")}return e},new Set)).join(" ")}},{key:"getClasses",value:function(){var e=this.props.matches.filter(function(e){return e.selected}).length>0?"WSelected":"";return"".concat(this.getRoleClass()," ").concat(e)}},{key:"forwardTeiAttributes",value:function(){return Array.from(this.props.teiDomElement.attributes).reduce(function(e,t){return e[t.name]=t.value,e},{})}},{key:"doClick",value:function(e){this.props.selectLink(e.linkIndex),this.props.getContextChapter?this.props.getContextChapter(e.linkedChapter):this.props.clearContextChapter()}},{key:"render",value:function(){var e=this,t={},a=[];if("tei-w"===this.props.teiDomElement.tagName.toLowerCase()){t={class:this.getClasses()};var n=!0,i=!1,o=void 0;try{for(var s,c=function(){var t=s.value;"firstLinked"===t.role&&a.push(r.a.createElement("span",{key:"".concat(e.props.teiDomElement.getAttribute("id"),"_").concat(t.idx),className:"ShowAlignment",onClick:function(){return e.doClick(t)}},"\u21e0"))},p=this.props.matches[Symbol.iterator]();!(n=(s=p.next()).done);n=!0)c()}catch(l){i=!0,o=l}finally{try{n||null==p.return||p.return()}finally{if(i)throw o}}}var h=Array.from(this.props.teiDomElement.childNodes).map(function(t,a){switch(t.nodeType){case 1:return r.a.createElement(J,{teiDomElement:t,key:"".concat(t.tagName,"_").concat(a),dataType:e.props.dataType,getContextChapter:e.props.getContextChapter,clearContextChapter:e.props.clearContextChapter});case 3:return t.nodeValue;default:return null}});return a.push(h),r.a.createElement(this.props.teiDomElement.tagName,Object(P.a)({},this.forwardTeiAttributes(),t,{ref:this.teiRef}),a)}}]),t}(n.Component)),J=Object(s.c)(function(e,t){var a=[];if(e.resources.alignment.data){var n=e.resources.alignment.data,r=t.teiDomElement,i="MishnahChapter"===t.dataType||"AlignedMishnah"===t.dataType?"m":"t";if("tei-w"===r.tagName.toLowerCase()){var o=r.getAttribute("xml:id");for(var s in n){var c=n[s];for(var p in c[i]){var h=parseInt(p);if(o===c[i][h]){var l={idx:s,selected:c.selected,linkIndex:parseInt(s)};switch(0===h?l.role="firstLinked":h===c[i].length-1?l.role="lastLinked":l.role="linked",t.dataType){case"AlignedTosefta":case"AlignedMishnah":l.linkedChapter=r.closest("tei-ab").getAttribute("xml:id").replace(/ref(-t)?\.(\d+\.\d+\.\d+)\.\d+/,"$2")}a.push(l)}}}}}return Object(P.a)({matches:a},t)},function(e,t){return{selectLink:function(t){return e(function(e){return{type:x,idx:e}}(t))},getContextChapter:t.getContextChapter,clearContextChapter:t.clearContextChapter}})(F),X=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(H.a)(this,Object(U.a)(t).call(this,e))).state={teiData:null,abs:[]},a}return Object(q.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.refs.teiData.innerHTML="Rendering TEI...";var t=new W.a;t.addBehaviors({tei:{ptr:null,ref:null}}),t.makeHTML5(this.props.teiData,function(t){e.setState({teiData:t}),e.refs.teiData.innerHTML="","MishnahChapter"!==e.props.dataType&&"ToseftaChapter"!==e.props.dataType&&e.setState({abs:Array.from(t.querySelectorAll("tei-ab"))})})}},{key:"getChapter",value:function(e){this.props.getContextChapter(e)}},{key:"render",value:function(){var e,t,a,n=this,i="MishnahChapter"===this.props.dataType||"ToseftaChapter"===this.props.dataType?"Simple":"AlignedText";if(this.state.abs.length>0)e=this.state.abs.map(function(e,t){return r.a.createElement("div",{key:t},r.a.createElement("div",{className:"Ab",onClick:function(){n.getChapter(e.getAttribute("xml:id").replace(/ref(-t)?\.(\d+\.\d+\.\d+)\.\d+/,"$2"))}},e.getAttribute("n")),r.a.createElement(J,{teiDomElement:e,dataType:n.props.dataType,viewerType:n.props.type,getContextChapter:n.props.getContextChapter,clearContextChapter:n.props.clearContextChapter}))});else if(this.state.teiData){t=this.state.teiData.getAttribute("n");var o=this.state.teiData.getAttribute("id").replace(/ref(-t)?\./,"");"context"===this.props.type&&(a=r.a.createElement("small",null,"\xa0(",r.a.createElement(h.b,{to:"/".concat("ToseftaChapter"===this.props.dataType?"tm":"mt","/").concat(o)},"align to this chapter"),")")),e=r.a.createElement(J,{teiDomElement:this.state.teiData,dataType:this.props.dataType,viewerType:this.props.type,getContextChapter:this.props.getContextChapter,clearContextChapter:this.props.clearContextChapter})}return[r.a.createElement("h2",{key:"h"},this.props.label," ",t," ",a),r.a.createElement("div",{key:"d",ref:"teiData",className:"Tei ".concat(i)},e)]}}]),t}(n.Component),B=(a(57),function(e){function t(){return Object(I.a)(this,t),Object(H.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(q.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){this.props.getAlignment(this.props.chapter)}},{key:"componentDidUpdate",value:function(e){this.props.chapter&&e.chapter!==this.props.chapter||this.props.order&&e.order!==this.props.order?(this.props.getAlignment(this.props.chapter),this.props.clearContextChapter()):!e.chapter&&this.props.chapter&&this.props.getAlignment(this.props.chapter)}},{key:"render",value:function(){var e,t,a="Loading alignment data...";return this.props.alignment&&this.props.driverChapter&&(e=r.a.createElement(X,{type:"driver",teiData:this.props.driverChapter,dataType:"mt"===this.props.order?"MishnahChapter":"ToseftaChapter",label:"mt"===this.props.order?"Mishnah":"Tosefta",alignmentData:this.props.alignment,clearContextChapter:this.props.clearContextChapter})),this.props.alignment&&this.props.alignedDocument&&(a=r.a.createElement(X,{type:"alignment",teiData:this.props.alignedDocument,dataType:"mt"===this.props.order?"AlignedTosefta":"AlignedMishnah",label:"mt"===this.props.order?"Aligned Tosefta":"Aligned Mishnah",alignmentData:this.props.alignment,getContextChapter:this.props.getContextChapter})),this.props.alignment&&this.props.contextChapter&&(t=r.a.createElement(X,{type:"context",teiData:this.props.contextChapter,dataType:"mt"===this.props.order?"ToseftaChapter":"MishnahChapter",label:"mt"===this.props.order?"Tosefta":"Mishnah",alignmentData:this.props.alignment,clearContextChapter:this.props.clearContextChapter})),r.a.createElement("div",{className:"Viewer"},r.a.createElement("div",{className:"Column",key:"a"},e),r.a.createElement("div",{className:"Column",key:"b"},a),r.a.createElement("div",{className:"Column",key:"c"},t))}}]),t}(n.Component)),$=Object(R.e)(Object(s.c)(function(e,t){var a,n,r,i,o,s=t.order?t.order:"mt",c=t.chapter?t.chapter:"1.1.1";return e.resources&&("mt"===s?(e.resources.mishnahChapter&&e.resources.alignment&&e.resources.alignedTosefta&&(a=e.resources.mishnahChapter.data,n=e.resources.alignment.data,r=e.resources.alignedTosefta.data),e.resources.toseftaChapter&&(i=e.resources.toseftaChapter.data,o=e.resources.toseftaChapter.chapter)):(e.resources.toseftaChapter&&e.resources.alignment&&e.resources.alignedMishnah&&(a=e.resources.toseftaChapter.data,n=e.resources.alignment.data,r=e.resources.alignedMishnah.data),e.resources.mishnahChapter&&(i=e.resources.mishnahChapter.data,o=e.resources.mishnahChapter.chapter))),{order:s,chapter:c,driverChapter:a,alignment:n,alignedDocument:r,contextChapter:i,contextChapterNumber:o}},function(e,t){var a=function(t){return e(S(t))},n=function(t){return e(M(t))},r=function(){return e({type:k})};return"mt"!==(t.order?t.order:"mt")&&(a=function(t){return e(L(t))},n=function(t){return e(w(t))},r=function(){return e({type:j})}),{getAlignment:a,getContextChapter:n,clearContextChapter:r}})(B)),K=function(e){function t(){return Object(I.a)(this,t),Object(H.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(q.a)(t,e),Object(V.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement(R.a,{path:"/:order?/:chapter?",render:function(e){return r.a.createElement($,{order:e.match.params.order,chapter:e.match.params.chapter})}})))}}]),t}(n.Component),Q=Object(R.e)(Object(s.c)(function(e,t){return{}},function(){return{}})(K)),z=m()(),G=Object(p.e)(N(z),Object(p.d)(Object(p.a)(Object(l.a)(z),c.a)));if(window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__){var Y=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({})(Object(p.a)(Object(l.a)(z),c.a));G=Object(p.e)(N(z),Y)}var Z=document.getElementById("mtviewer");o.a.render(r.a.createElement(s.a,{store:G},r.a.createElement(u.a,{history:z},r.a.createElement(h.a,null,r.a.createElement(Q,null)))),Z)}},[[39,1,2]]]);
//# sourceMappingURL=main.cdf31738.chunk.js.map